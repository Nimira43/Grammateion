import{defaultTransformer as o,isPlainObject as f,isRedirect as v,isNotFound as m}from"@tanstack/react-router";import h from"tiny-invariant";import{t as F,g as S,a as T}from"./http.mjs";import{eventHandler as N}from"h3";import"unctx";import"node:async_hooks";function j(n){return globalThis.MANIFEST[n]}const J=N(C);async function C(n){return E(F(n))}async function E(n,c){var r,l;const u=n.method,g=new URL(n.url,"http://localhost:3000"),s=Object.fromEntries(g.searchParams.entries()),a=s._serverFnId,p=s._serverFnName;if(!a||!p)throw new Error("Invalid request");h(typeof a=="string","Invalid server action");const w=(l=await((r=j("server").chunks[a])==null?void 0:r.import()))==null?void 0:l[p],i=await(async()=>{try{const e=await(async()=>{var d;if((d=n.headers.get("Content-Type"))!=null&&d.includes("multipart/form-data"))return h(u.toLowerCase()!=="get","GET requests with FormData payloads are not supported"),await n.formData();if(u.toLowerCase()==="get")return s.payload?o.parse(s.payload):void 0;const R=await n.text();return o.parse(R)})(),t=await w(e);return t instanceof Response?t:f(t)&&"result"in t&&t.result instanceof Response?t.result:v(t)||m(t)?y(t):new Response(t!==void 0?o.stringify(t):void 0,{status:S(T()),headers:{"Content-Type":"application/json"}})}catch(e){return e instanceof Response?e:f(e)&&"result"in e&&e.result instanceof Response?e.result:v(e)||m(e)?y(e):(console.error("Server Fn Error!"),console.error(e),console.info(),new Response(o.stringify(e),{status:500,headers:{"Content-Type":"application/json"}}))}})();if(i.headers.get("Content-Type")==="application/json"){const t=await i.clone().text();t&&JSON.stringify(JSON.parse(t))}return i}function y(n){const{headers:c,...r}=n;return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json",...c||{}}})}export{J as default};
